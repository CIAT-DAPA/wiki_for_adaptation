{% load static wagtailcore_tags wagtailuserbar %}

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>
            {% block title %}
            {% if page.seo_title %}{{ page.seo_title }}{% else %}{{ page.title }}{% endif %}
            {% endblock %}
            {% block title_suffix %}
            {% wagtail_site as current_site %}
            {% if current_site and current_site.site_name %}- {{ current_site.site_name }}{% endif %}
            {% endblock %}
        </title>
        {% if page.search_description %}
        <meta name="description" content="{{ page.search_description }}" />
        {% endif %}
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        {# Force all links in the live preview panel to be opened in a new tab #}
        {% if request.in_preview_panel %}
        <base target="_blank">
        {% endif %}

        {# Global stylesheets #}
        {# Tailwind CSS #}
        <script src="https://cdn.tailwindcss.com"></script>
        <script>
            tailwind.config = {
                theme: {
                    extend: {
                        colors: {
                            'brand-green': '#10b981',
                            'brand-red': '#ef4444',
                            'brand-orange': '#f97316',
                        }
                    }
                }
            }
        </script>
        <link rel="stylesheet" type="text/css" href="{% static 'css/mysite.css' %}">
        
        {# Font Awesome Icons #}
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

        <style>
            /* Smooth dropdown transitions */
            nav .group > div > div {
                transition: opacity 200ms ease-in-out, visibility 200ms ease-in-out;
            }
        </style>

        {% block extra_css %}
        {# Override this in templates to add extra stylesheets #}
        {% endblock %}

        {# Google Analytics - Only when GOOGLE_ANALYTICS_ID is set (production) #}
        {% if GOOGLE_ANALYTICS_ID %}
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id={{ GOOGLE_ANALYTICS_ID }}"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', '{{ GOOGLE_ANALYTICS_ID }}');
        </script>
        {% endif %}
    </head>

        <body class="bg-gray-50 min-h-screen flex flex-col {% block body_class %}{% endblock %}">
                {% wagtailuserbar %}

                <!-- Navbar -->
                <nav class="sticky top-0 z-50 bg-white border-b border-gray-200 shadow-sm">
                    <div class="max-w-7xl mx-auto px-4 flex items-center justify-between h-16">
                        <div class="flex items-center gap-6">
                            <a href="/" class="font-bold text-lg text-gray-900 flex items-center"><img src="{% static 'images/logo_navbar.png' %}" alt="Wiki" class="h-8 w-auto mr-2">Wiki</a>
                            <form action="/search/" method="get" class="hidden md:flex items-center bg-gray-100 rounded-lg px-3 py-2 ml-4 w-96">
                                <i class="fa fa-search text-gray-400 mr-2"></i>
                                <input type="text" name="query" placeholder="Search by name, description, or keywords..." class="bg-transparent outline-none flex-1 text-sm text-gray-700" />
                            </form>
                        </div>
                        <div class="flex items-center gap-6">
                            <a href="/search/?category=indicator" class="text-gray-700 hover:text-brand-green font-medium flex items-center gap-1"><i class="fa-solid fa-chart-bar text-xs"></i> Indicators</a>
                            
                            <!-- Tracking Framework Dropdown -->
                            <div class="relative group">
                                <a href="/tracking-framework/" class="text-gray-700 hover:text-brand-green font-medium flex items-center">
                                    <i class="fa-solid fa-chart-network text-xs mr-1"></i>Tracking Framework<i class="fa fa-chevron-down text-xs ml-1"></i>
                                </a>
                                <div class="absolute left-0 top-full pt-2 w-64">
                                    <div class="bg-white border border-gray-200 rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all">
                                        <a href="/impact-pathways/guidance" class="block px-4 py-3 text-gray-700 hover:bg-gray-50 border-b border-gray-100">Guidance: Project vs policy level</a>
                                        <a href="/tracking-framework#tracking-framework" class="block px-4 py-3 text-gray-700 hover:bg-gray-50 border-b border-gray-100">Tracking framework</a>
                                        <a href="/tracking-framework#indicator-framework" class="block px-4 py-3 text-gray-700 hover:bg-gray-50 border-b border-gray-100">Indicator framework</a>
                                        <a href="/tracking-framework#selection-criteria" class="block px-4 py-3 text-gray-700 hover:bg-gray-50">Selection criteria</a>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Help Dropdown -->
                            <div class="relative group">
                                <button class="text-gray-700 hover:text-brand-green font-medium flex items-center gap-1">
                                    <i class="fa-regular fa-circle-question text-xs"></i> Help <i class="fa fa-chevron-down text-xs ml-1"></i>
                                </button>
                                <div class="absolute left-0 top-full pt-2 w-64">
                                    <div class="bg-white border border-gray-200 rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all">
                                        <a href="/wiki-instructions" class="block px-4 py-3 text-gray-700 hover:bg-gray-50 border-b border-gray-100">How to navigate this wiki</a>
                                        <a href="/faq" class="block px-4 py-3 text-gray-700 hover:bg-gray-50">FAQ</a>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Collaborate Dropdown -->
                            <div class="relative group">
                                <button class="text-gray-700 hover:text-brand-green font-medium flex items-center gap-1">
                                    <i class="fa-solid fa-users text-xs"></i> Collaborate <i class="fa fa-chevron-down text-xs ml-1"></i>
                                </button>
                                <div class="absolute left-0 top-full pt-2 w-64">
                                    <div class="bg-white border border-gray-200 rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all">
                                        <a href="/become-editor" class="block px-4 py-3 text-gray-700 hover:bg-gray-50 border-b border-gray-100">Become an editor</a>
                                        <a href="/feedback" class="block px-4 py-3 text-gray-700 hover:bg-gray-50">Feedback/Corrections</a>
                                    </div>
                                </div>
                            </div>
                            
                            <a href="/about" class="text-gray-700 hover:text-brand-green font-medium flex items-center gap-1"><i class="fa-solid fa-circle-exclamation text-xs"></i> About</a>
                            
                            <!-- Login/Register -->
                            {% if user.is_authenticated %}
                            <div class="relative group">
                                <button class="text-gray-700 hover:text-brand-green font-medium flex items-center gap-1">
                                    <i class="fa-solid fa-user-circle text-sm"></i> 
                                    <span class="hidden lg:inline">{{ user.username }}</span>
                                    <i class="fa fa-chevron-down text-xs ml-1"></i>
                                </button>
                                <div class="absolute right-0 top-full pt-2 w-48">
                                    <div class="bg-white border border-gray-200 rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all">
                                        <a href="/admin/" class="block px-4 py-3 text-gray-700 hover:bg-gray-50 border-b border-gray-100">
                                            <i class="fa-solid fa-gauge text-xs mr-2"></i>Admin Panel
                                        </a>
                                        <a href="/admin/logout/" class="block px-4 py-3 text-gray-700 hover:bg-gray-50">
                                            <i class="fa-solid fa-right-from-bracket text-xs mr-2"></i>Logout
                                        </a>
                                    </div>
                                </div>
                            </div>
                            {% else %}
                            <a href="/admin/" class="px-4 py-2 bg-brand-green text-white rounded-lg font-semibold hover:bg-green-600 transition flex items-center gap-2">
                                <i class="fa-solid fa-right-to-bracket text-xs"></i> 
                                Login
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </nav>

                <!-- Django Messages -->
                {% if messages %}
                <div class="w-full bg-white border-b border-gray-200">
                    <div class="max-w-7xl mx-auto px-4 py-3">
                        {% for message in messages %}
                        <div class="{% if message.tags == 'error' %}bg-red-50 border border-red-200 text-red-800{% elif message.tags == 'warning' %}bg-yellow-50 border border-yellow-200 text-yellow-800{% elif message.tags == 'success' %}bg-green-50 border border-green-200 text-green-800{% else %}bg-blue-50 border border-blue-200 text-blue-800{% endif %} rounded-lg p-4 mb-2 last:mb-0 flex items-start gap-3">
                            <i class="{% if message.tags == 'error' %}fa-solid fa-circle-exclamation text-red-600{% elif message.tags == 'warning' %}fa-solid fa-triangle-exclamation text-yellow-600{% elif message.tags == 'success' %}fa-solid fa-circle-check text-green-600{% else %}fa-solid fa-circle-info text-blue-600{% endif %} mt-0.5"></i>
                            <div class="flex-1">{{ message }}</div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <main class="flex-1 w-full">
                    {% block content %}{% endblock %}
                </main>

                <!-- Footer -->
                <footer class="bg-white border-t border-gray-200 mt-8">
                    <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
                        <span class="font-bold text-gray-900 flex items-center"><img src="{% static 'images/logo_navbar.png' %}" alt="Wiki" class="h-8 w-auto mr-2">Wiki</span>
                        <img src="{% static 'images/logo_footer.png' %}" alt="CGIAR Climate Action" class="h-16 w-auto">
                    </div>
                </footer>

                <script type="text/javascript" src="{% static 'js/mysite.js' %}"></script>

                {% block extra_js %}
                {# Override this in templates to add extra javascript #}
                {% endblock %}
        </body>
</html>
